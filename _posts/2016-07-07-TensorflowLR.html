---
layout: post
title: Linear Regression in Tensorflow
subtitle: Predicting house prices in Boston area
published: true
gh-repo: aqibsaeed/Tensorflow-ML
gh-badge: [star, fork, follow]
---

<div class="text-justify">
<p>Tensorflow is an open source machine learning (ML) library from Google. It has particularly became popular because of the support for Deep Learning. Apart from that it's highly scalable and can run on Android.  The documentation is well maintained and several tutorials available for different expertise levels. To learn more about downloading and installing Tesnorflow, visit <a href="https://www.tensorflow.org/">official website.</a></p>
	
<p>To scratch the surface of this incredible ML library, we will implement Linear Regression to predict prices of houses in Boston area. The <a href="https://archive.ics.uci.edu/ml/datasets/Housing">Boston dataset</a> is available at UCI Machine Learning Repository. It is also available in R and scikit-learn. If you don't know the maths behind Linear Regression, some great resources are provided at the end of this tutorial.

</p>
<p>Let's get started.</p>
<p>Firstly, we will import the required libraries which includes: TensorFlow, Numpy and Matplotlib.
<script src="https://gist.github.com/aqibsaeed/45f6002b3ee086e8ee2faa63cea15320.js"></script>
</p>
	
<p>Now, lets define some methods for preparing the dataset for Linear Regression model training. The first method named <code>read_dataset</code> can be used to read text (e.g. csv or tsv) to Numpy array. Second method <code>read_boston_data</code> is more specific to this tutorial. It will read Boston dataset from scikit-learn library and will return features and labels separately. The third method <code>feature_normalize</code> will be used to normalize the features of the dataset. Feature normalization is an important pre-processing step, as features on different scale can easily mislead the learning process. The last method <code>append_bias_reshape</code> is used to append bias term (all 1's) to the normalized features. It corresponds to <code>b</code> term in equation of straight line. Moreover, this method will reshape the features so that it will be feed to TensorFlow library. If you are new to Python, I would say pay close attention to the shape of Numpy arrays. This thing can easily go wrong and sometimes take considerable time for debugging.
  <script src="https://gist.github.com/aqibsaeed/74e755b8181500538105b16fdb8f6fe2.js"></script>
</p>
  
<p>We will now call the above defined methods and divide the dataset into two parts for training and testing. Using cross validation is also an option, but I am leaving this to you to try it out. 
  <script src="https://gist.github.com/aqibsaeed/4549fb5efefc56b105ca292c19a2d781.js"></script>
</p>

<p>TensorFlow has it's own data structures for holding features, labels and weights etc. Lets define those including some variable required to hold important data related to Linear Regression algorithm.	<script src="https://gist.github.com/aqibsaeed/d898fc222e263f5fd4a969a39fec918b.js"></script>
 </p>
  
<p>Linear Regression implementation is pretty straight forward in TensorFlow. Three lines of code is all that is required. First line will multiply features matrix to weights matrix and can be used for prediction. The second line is cost or loss function (squared error of regression line). Finally, the third line perform one step of gradient descent optimization to minimize the cost function.
  <script src="https://gist.github.com/aqibsaeed/f52f8af3082669be372bf13e67478ff5.js"></script>
 </p>

<p>We have all the required parts of the code to implement Linear Regression. One missing detail is training of Linear Regression model. Following code will do this for us:
	<script src="https://gist.github.com/aqibsaeed/81fd2f8952d4eacf7c6c22a2f01cd47b.js"></script>
</p>
  
<p>Now we have a trained Linear Regression model. We are now able to make predictions on unseen data. But first plot the cost as a function of number of iterations. It's pretty straight forward using Matplotlib.
	<script src="https://gist.github.com/aqibsaeed/c2f593417c991b3cfb822f6b8430bd51.js"></script>
	<img src="/img/tf_lr_cost.png" alt="cost vs. number of iterations plot"/>	
</p>
	
<p>Make some predictions on test dataset and calculate mean square error (it should be around <i>22.23</i>). The plot below also showing the original and predicted prices for houses and the learned regression line.
	<script src="https://gist.github.com/aqibsaeed/e6d60717bc439197eca7c228d3254da0.js"></script>
  	<img src="/img/tf_lr_pred.png" alt="prediction vs. origianl price labels"/>
</p>

<p>When you are done working with TensorFlow session, do call <code>close</code> on <code>sess</code> object as <code>sess.close()</code></p> 
  
<p>I hope you liked this tutorial. If you want to learn more about maths behind Linear Regression or ML in general, do check the following resources:  
	<ul>
      <li><a href="https://www.khanacademy.org/math/probability/regression/regression-correlation/v/regression-line-example">Linear Regression on Khan Academy</a></li>
      <li><a href="https://www.coursera.org/learn/machine-learning">Machine learning course on Coursera by Andrew Ng</a></li>
      <li><a href="http://eu.wiley.com/WileyCDA/WileyTitle/productCd-0470542810.html">Introduction to Linear Regression Analysis by Douglas Montgomery, Elizabeth A. Peck, and G. Geoffrey Vining</a></li>
  	</ul> 
</p>
<p>If you have any question or feedback, please do reach out to me by commenting below.</p>
</div>
